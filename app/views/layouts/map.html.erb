<!DOCTYPE html>
<html>
<head>
  <title>YetiBarrage</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <script type="text/javascript"
    src="http://maps.googleapis.com/maps/api/js?key=<%= @google_maps_api_key %>&sensor=false">
  </script>
  <script type="text/javascript">
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(38.830, -104.820),
        zoom: 12,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      };
      map = new google.maps.Map(document.getElementById("map_canvas"),
        mapOptions);

      yetis = {};
      mapYetis();
    }

    function mapYetis() {
      var yetiList = JSON.parse(getYetis());

      for (i = 0; i < yetiList.length; i++) {
        var yeti = yetiList[i];
        var yetiLatLong = new google.maps.LatLng(yeti.lat, yeti.long);
        var marker = new google.maps.Marker({
          position: yetiLatLong,
          title: yeti.name
        });

        marker.setMap(map);
      }
    }

    function getYetis() {
      var xmlHttp = null;

      xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", "/yetis.json", false);
      xmlHttp.send(null);

      return xmlHttp.responseText;
    }
  </script>
</head>
<body onload="initialize()">

<%= yield %>

  <div id="map_canvas" style="width:100%; height:100%"></div>

</body>
</html>
